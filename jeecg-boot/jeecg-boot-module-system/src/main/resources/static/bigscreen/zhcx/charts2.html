<!DOCTYPE html>
<html style="height: 100%;">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">

		<title>问题统计</title>
		<style type="text/css">
			html,
			body {
				width: 100%;
				height: 100%;
				padding: 0;
				margin: 0;
				overflow: hidden;
			}

			#container1 {
				position: absolute;
				top: 0px;
				left: 0px;
				width: 215px;
				height: 260px;
			}

			#container2 {
				position: absolute;
				top: 0px;
				left: 215px;
				width: 415px;
				height: 260px;
			}
		</style>

		<script type="text/javascript" src="js/echarts.min.js"></script>
		<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>

	</head>

	<body>
		<div id="container1"></div>

		<div id="container2"></div>

		<script type="text/javascript">
			//地址参数
			function getQueryVariable(variable) {
				var query = window.location.search.substring(1);
				var vars = query.split("&");
				for (var i = 0; i < vars.length; i++) {
					var pair = vars[i].split("=");
					if (pair[0] == variable) {
						return pair[1];
					}
				}
				return (false);
			}


			var dom1 = document.getElementById("container1");
			var myChart1 = echarts.init(dom1);

			var dom2 = document.getElementById("container2");
			var myChart2 = echarts.init(dom2);

			var 项目ID = getQueryVariable("id");

			$.ajax({
				url: "http://172.168.201.105:8080/jeecg-boot/interface/api/getProjectProblemCensus2",
				async: true,
				type: "post",
				dataType: "json",
				data: {
					id: 项目ID
				},
				success: function(record) {
					var totalProblem = record.result.totalProblem;
					var 行数 = Math.ceil(totalProblem.length / 2);

					var newlegend = new Array();

					for (var i = 0; i < 行数; i++) {
						var datatemp = new Array();
						if (totalProblem[i * 2 + 0] != null) {
							datatemp.push(totalProblem[i * 2 + 0].problemType);
						}
						if (totalProblem[i * 2 + 1] != null) {
							datatemp.push(totalProblem[i * 2 + 1].problemType);
						}
						newlegend.push({
							//orient: 'vertical',
							left: 10,
							bottom: 20 * (i + 1),
							data: datatemp,
							textStyle: {
								color: '#FFFFFF'
							}
						});
					}

					var newdata = new Array();
					for (var j = 0; j < totalProblem.length; j++) {
						newdata.push({
							value: totalProblem[j].value,
							name: totalProblem[j].problemType
						});
					}

					option1 = {
						color: ['#04a7f3', '#e7c42c', '#38c171', '#b445d9'],
						tooltip: {
							trigger: 'item',
							formatter: '{a} <br/>{b}: {c} ({d}%)'
						},
						legend: newlegend,
						series: [{
							name: '问题统计',
							type: 'pie',
							center: ['50%', '40%'],
							radius: ['50%', '70%'],
							avoidLabelOverlap: false,
							label: {
								show: true,
								position: 'inside',
								formatter: '{c}'
							},
							emphasis: {
								label: {
									show: true,
									fontSize: '30',
									fontWeight: 'bold'
								}
							},
							labelLine: {
								show: false
							},
							data: newdata
						}]
					};
					myChart1.setOption(option1, true);

					// var prjectProblem = record.result.prjectProblem;
					// var Xdata = new Array();
					// for (var i = 0; i < prjectProblem.length; i++) {
					//     Xdata.push(prjectProblem[i].problemLocation);
					// }

					var problemList = record.result.problemList;
					var sdata = new Array();
					for (var i = 0; i < problemList.length; i++) {
						sdata.push({
							name: problemList[i].problemType,
							type: 'bar',
							stack: '总量',
							label: {
								show: true,
								position: 'inside'
							},
							data: problemList[i].array,
							barWidth: 20
						}, );
					}

					option2 = {
						color: ['#04a7f3', '#e7c42c', '#38c171', '#b445d9'],
						grid: {
							left: '10%',
							right: '0%',
							top: '12%',
							bottom: '20%'
						},
						yAxis: {
							type: 'value',
							axisLabel: {
								textStyle: {
									color: '#9faed5',
								}
							},
							axisLine: {
								show: false
							},
							splitLine: {
								show: true,
								lineStyle: {
									color: '#274072'
								}
							}
						},
						xAxis: {
							type: 'category',
							data: record.result.locationList,
							//data: ['钢筋场', '过渡模', '暗埋模', '位置1', '位置2', '位置3', '位置4'],
							axisLabel: {
								textStyle: {
									color: '#9faed5',
									margin: 15,
								},
								rotate: 40
							},
							axisLine: {
								show: true,
								lineStyle: {
									color: 'rgb(0, 255, 255)'
								},
							},
						},
						series: sdata
					};

					myChart2.setOption(option2, true);







				}
			});
		</script>
	</body>

</html>
